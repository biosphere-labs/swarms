---
name: ContextShardingManager — Per-sub-agent context isolation
status: open
created: 2026-02-11T21:01:30Z
updated: 2026-02-11T21:01:30Z
depends_on: []
parallel: true
conflicts_with: []
---

# Task: ContextShardingManager — Per-sub-agent context isolation

## Description
Implement the ContextShardingManager that creates isolated context windows for each sub-agent and collects structured results. This is the core differentiator from existing ConcurrentWorkflow which shares context.

## Acceptance Criteria
- [ ] ContextShardingManager class with `create_shard(sub_task, parent_context) -> ContextShard` method
- [ ] Each shard contains only task-relevant context (not the full conversation)
- [ ] `collect_result(agent_id, result) -> StructuredResult` method for gathering outputs
- [ ] Context shards are immutable once created (no cross-contamination between sub-agents)
- [ ] Structured results include: agent_id, sub_task_id, output, confidence, metadata
- [ ] Token budget awareness: track estimated tokens per shard

## Technical Details
- File: `swarms/structs/context_sharding.py`
- ContextShard: contains system_prompt, task_description, relevant_context_slice, output_format
- StructuredResult: Pydantic model with agent_id, sub_task_id, output (str), confidence (float), metadata (dict)
- Sharding strategy: extract relevant portions from parent context based on context_hints from DecompositionEngine
- Token counting via LiteLLM's token_counter utility

## Dependencies
- [ ] None (standalone module)

## Effort Estimate
- Size: M
- Hours: 5-8
- Parallel: true (no dependencies on other new modules)

## Definition of Done
- [ ] Code implemented
- [ ] Unit tests written and passing
- [ ] Shards contain only relevant context (not full parent context)
- [ ] Results are properly structured and collectible
